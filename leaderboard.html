<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Leaderboards - Diane Keaton Memorial Arcade</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    :root {
      --neon-blue: #00f3ff;
      --neon-purple: #bf00ff;
      --neon-pink: #ff00ff;
      --neon-green: #39ff14;
      --neon-gold: #ffd700;
      --dark-bg: #050510;
      --darker: #020208;
    }
    body {
      font-family:'Roboto',sans-serif;
      background:var(--dark-bg);
      color:#fff;
      overflow-x:hidden;
    }
    body::before{
      content:'';
      position:fixed; inset:0;
      background:
        linear-gradient(90deg, transparent 49%, rgba(0,243,255,0.06) 50%, transparent 51%),
        linear-gradient(0deg, transparent 49%, rgba(0,243,255,0.06) 50%, transparent 51%);
      background-size:50px 50px;
      z-index:-1; animation:gridMove 20s linear infinite;
    }
    @keyframes gridMove { 0%{transform:translate(0,0);}100%{transform:translate(50px,50px);} }

    .nav-bar{
      position:sticky; top:0;
      background:rgba(5,5,16,0.98); padding:20px 50px;
      display:flex; justify-content:space-between; align-items:center;
      border-bottom:3px solid var(--neon-blue); box-shadow:0 5px 40px rgba(0,243,255,0.4);
      z-index:2000; flex-wrap:wrap; gap:20px;
    }
    .nav-brand{ font-family:'Orbitron'; font-weight:900; color:var(--neon-blue); letter-spacing:2px; text-shadow:0 0 20px var(--neon-blue); font-size:1.5em; }
    .nav-links{ display:flex; gap:25px; flex-wrap:wrap; }
    .nav-link{
      font-family:'Orbitron'; color:#fff; text-decoration:none; padding:12px 28px;
      border:2px solid var(--neon-blue); border-radius:30px; transition:all .3s; font-weight:700; letter-spacing:1px; font-size:.9em;
    }
    .nav-link:hover{ background:var(--neon-blue); color:var(--darker); box-shadow:0 0 30px var(--neon-blue); transform:translateY(-3px); }
    .profile-btn{ background:linear-gradient(135deg,var(--neon-purple),var(--neon-pink)); border:none; box-shadow:0 0 25px var(--neon-purple); }
    .bot-btn{ background:linear-gradient(135deg,#39ff14,#00f3ff); border:none; color:#000; box-shadow:0 0 25px #39ff14; color:white; }

    .container{ padding:40px; max-width:1200px; margin:0 auto; }
    .page-title{ font-family:'Orbitron'; text-align:center; font-size:3em; margin-bottom:20px; }

    .category-tabs{ display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin:24px 0; }
    .category-tab{
      background:rgba(255,255,255,0.03); border:2px solid rgba(255,255,255,0.04);
      padding:10px 18px; border-radius:18px; cursor:pointer; color:#fff; font-weight:700;
    }
    .category-tab.active{ border-color:var(--neon-blue); box-shadow:0 0 20px var(--neon-blue); }

    .leaderboard-section{ display:none; margin-top:20px; }
    .leaderboard-section.active{ display:block; }
    .leaderboard-header{ text-align:center; margin-bottom:12px; }
    .leaderboard-title{ font-family:'Orbitron'; font-size:1.6em; margin-bottom:6px; color:var(--neon-blue); text-shadow:0 0 10px var(--neon-blue); }
    .leaderboard-subtitle{ opacity:0.8; }

    .podium{ display:flex; gap:12px; justify-content:center; margin:18px 0 28px; }
    .podium-place{ background:rgba(255,255,255,0.03); padding:18px; border-radius:12px; min-width:150px; text-align:center; }

    .leaderboard-table table{ width:100%; border-collapse:collapse; background:rgba(0,0,0,0.25); border-radius:8px; overflow:hidden; }
    .leaderboard-table th, .leaderboard-table td{ padding:12px 16px; text-align:left; border-bottom:1px solid rgba(255,255,255,0.03); }
    .player-cell{ display:flex; gap:12px; align-items:center; }
    .player-avatar{ width:48px; height:48px; border-radius:8px; object-fit:cover; }
    .view-profile-btn{ display:inline-block; padding:8px 12px; border-radius:8px; border:1px solid var(--neon-blue); text-decoration:none; color:var(--neon-blue); font-weight:700; }

    .footer {
      background: rgba(5,5,16,0.95);
      border-top:3px solid var(--neon-blue);
      padding:60px 40px 40px; margin-top:60px; text-align:center;
    }
    .footer h3{ font-family:'Orbitron'; color:var(--neon-blue); font-size:2em; margin-bottom:12px; text-shadow:0 0 30px var(--neon-blue); }
    .footer-links{ display:flex; gap:20px; justify-content:center; flex-wrap:wrap; margin:30px 0; }
    .footer-link{ padding:12px 20px; border-radius:20px; border:2px solid var(--neon-blue); text-decoration:none; color:var(--neon-blue); font-weight:700; }

    @media (max-width:768px){
      .page-title{ font-size:2rem; }
      .podium{ flex-direction:column; align-items:center; }
      .player-avatar{ width:40px; height:40px; }
    }
  </style>
</head>
<body>
  <nav class="nav-bar">
    <div class="nav-brand">üèÜ LEADERBOARDS</div>
    <div class="nav-links">
      <a class="nav-link" href="index.html">HOME</a>
      <a class="nav-link" href="achievements.html">ACHIEVEMENTS</a>
      <a class="nav-link bot-btn" href="bot.html">DIANE BOT ü§ñ</a>
      <a class="nav-link profile-btn" href="profile.html">MY PROFILE</a>
    </div>
  </nav>

  <div class="container">
    <h1 class="page-title">üèÜ LEADERBOARDS üèÜ</h1>
    <div class="category-tabs" id="category-tabs"></div>
    <div id="leaderboards-container"></div>
  </div>

  <div class="footer">
    <h3>IN MEMORY OF DIANE KEATON</h3>
    <p>January 5, 1946 - October 11, 2025</p>
    <p style="font-size:1.1em;margin:12px 0;">Forever in Our Hearts ‚ù§Ô∏è</p>
    <p>Academy Award Winner ‚Ä¢ Director ‚Ä¢ Fashion Icon ‚Ä¢ Legend</p>
    <p style="max-width:800px;margin:18px auto 0;opacity:0.95;">
      "This arcade preserves classic Flash games in honor of Diane's timeless legacy.
      Her films taught us to laugh, love, and never take life too seriously."
    </p>

    <div class="footer-links" style="margin-top:22px;">
      <a class="footer-link" href="index.html#games">GAMES</a>
      <a class="footer-link" href="achievements.html">ACHIEVEMENTS</a>
      <a class="footer-link" href="leaderboard.html">LEADERBOARD</a>
      <a class="footer-link" href="bot.html">DIANE BOT ü§ñ</a>
      <a class="footer-link" href="profile.html">PROFILE</a>
      <a class="footer-link" href="https://discord.gg/jR8tcWF" target="_blank">DISCORD</a>
    </div>

    <p style="opacity:0.7;margin-top:26px;">
      ¬© 2025 Diane Keaton Memorial Arcade ‚Ä¢ Powered by Ruffle Flash Emulator<br>
      All games are property of their respective creators ‚Äî preserved for educational & nostalgic purposes
    </p>
    <p style="opacity:0.6;margin-top:12px;">Created with ‚ù§Ô∏è by Game Killers Studio‚Ñ¢</p>
  </div>

  <!-- If you already provide external JS files, keep these lines; if not, it's ok to remove them.
       They are left commented so they won't 404 if you don't have them. Uncomment if you do. -->
  <!-- <script src="js/games.js"></script>
  <script src="js/players.js"></script>
  <script src="js/leaderboard.js"></script> -->

  <!-- CORE leaderboard script (won't override your own implementations if they exist) -->
  <script>
  (function(){
    // Use provided GAMES and getAllPlayers if available; otherwise warn and provide minimal placeholders that won't interfere.
    if (typeof GAMES === 'undefined') {
      console.warn('GAMES not found ‚Äî leaving GAMES as empty object (your external js/games.js should define it).');
      window.GAMES = window.GAMES || {};
    }

    if (typeof getAllPlayers !== 'function') {
      console.warn('getAllPlayers() not found ‚Äî defining a safe placeholder that returns an empty array. Replace with your implementation.');
      window.getAllPlayers = function(){ return []; };
    }

    // Define createPodium only if not already defined by your external code.
    if (typeof createPodium !== 'function') {
      window.createPodium = function(players, containerId, scoreType) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = ''; // clear
        // We show top 3 or fewer
        const top = players.slice(0,3);
        top.forEach((p, idx) => {
          const div = document.createElement('div');
          div.className = 'podium-place';
          const place = idx === 0 ? '1st' : (idx === 1 ? '2nd' : '3rd');
          const score = scoreType === 'xp' ? (p.xp || 0).toLocaleString() : (p.score || 0).toLocaleString();
          div.innerHTML = `<div style="font-weight:800;font-family:Orbitron">${place}</div>
                           <div style="margin-top:8px;font-weight:700">${p.username || 'Unknown'}</div>
                           <div style="opacity:.85;margin-top:6px">${score}</div>`;
          container.appendChild(div);
        });
      };
    }

    // Define populateTable only if not already defined.
    if (typeof populateTable !== 'function') {
      window.populateTable = function(players, tbodyId, type) {
        const tbody = document.getElementById(tbodyId);
        if (!tbody) return;
        tbody.innerHTML = '';
        players.forEach((player, index) => {
          const rank = index + 1;
          // rank emoji and class
          let rankEmoji = '';
          let rankClass = '';
          if (rank === 1) { rankEmoji = 'ü•á'; rankClass = 'first'; }
          else if (rank === 2) { rankEmoji = 'ü•à'; rankClass = 'second'; }
          else if (rank === 3) { rankEmoji = 'ü•â'; rankClass = 'third'; }

          const row = document.createElement('tr');
          // bot badge
          const botBadge = player.isBot ? '<span class="bot-badge" style="font-size:0.8em;margin-left:8px;">ü§ñ BOT</span>' : '';

          if (type === 'global') {
            row.innerHTML = `
              <td class="rank-cell ${rankClass}">${rankEmoji} #${rank}</td>
              <td>
                <div class="player-cell">
                  <img src="${player.avatar || ('https://api.dicebear.com/7.x/avataaars/svg?seed=' + encodeURIComponent(player.username || 'guest'))}" alt="${player.username || 'Unknown'}" class="player-avatar">
                  <div>
                    <div class="player-name">${player.username || 'Unknown'} ${botBadge}</div>
                    <div class="player-level">Level ${player.level || 1}</div>
                  </div>
                </div>
              </td>
              <td><span style="font-family:Orbitron;font-weight:700;">${player.level || 1}</span></td>
              <td class="score-cell">${(player.xp || 0).toLocaleString()}</td>
              <td><span style="font-family:Orbitron;font-weight:700;">${player.achievementsCount || 0}/50</span></td>
              <td><a class="view-profile-btn" href="profile.html?user=${encodeURIComponent(player.username || '')}">VIEW</a></td>
            `;
          } else {
            row.innerHTML = `
              <td class="rank-cell ${rankClass}">${rankEmoji} #${rank}</td>
              <td>
                <div class="player-cell">
                  <img src="${player.avatar || ('https://api.dicebear.com/7.x/avataaars/svg?seed=' + encodeURIComponent(player.username || 'guest'))}" alt="${player.username || 'Unknown'}" class="player-avatar">
                  <div class="player-name">${player.username || 'Unknown'} ${botBadge}</div>
                </div>
              </td>
              <td class="score-cell">${(player.score || 0).toLocaleString()}</td>
              <td>${player.date || 'N/A'}</td>
              <td><a class="view-profile-btn" href="profile.html?user=${encodeURIComponent(player.username || '')}">VIEW</a></td>
            `;
          }

          tbody.appendChild(row);
        });
      };
    }

    // showCategory toggles visible section based on tab clicked
    if (typeof showCategory !== 'function') {
      window.showCategory = function(category) {
        // toggle tab active class
        document.querySelectorAll('.category-tab').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.category === category);
        });
        // toggle sections
        document.querySelectorAll('.leaderboard-section').forEach(sec => {
          sec.classList.toggle('active', sec.id === (category + '-section') || (category === 'global' && sec.id === 'global-section'));
        });
      };
    }

    // buildLeaderboards: create tabs and sections (keeps your original content structure)
    function buildLeaderboards() {
      const tabsContainer = document.getElementById('category-tabs');
      const leaderboardsContainer = document.getElementById('leaderboards-container');
      if (!tabsContainer || !leaderboardsContainer) return;

      tabsContainer.innerHTML = '';
      // global tab
      const globalBtn = document.createElement('button');
      globalBtn.className = 'category-tab active';
      globalBtn.dataset.category = 'global';
      globalBtn.innerText = 'üåç GLOBAL';
      globalBtn.onclick = () => showCategory('global');
      tabsContainer.appendChild(globalBtn);

      // game tabs based on GAMES object
      Object.keys(window.GAMES || {}).forEach(gameId => {
        const game = window.GAMES[gameId];
        const btn = document.createElement('button');
        btn.className = 'category-tab';
        btn.dataset.category = gameId;
        btn.innerText = `${game.icon || ''} ${String(game.name || '').toUpperCase()}`;
        btn.onclick = () => showCategory(gameId);
        tabsContainer.appendChild(btn);
      });

      // Build global section
      leaderboardsContainer.innerHTML = `
        <div class="leaderboard-section active" id="global-section">
          <div class="leaderboard-header">
            <h2 class="leaderboard-title">üåç GLOBAL RANKINGS</h2>
            <p class="leaderboard-subtitle">Top players by total XP across all games</p>
          </div>
          <div class="podium" id="global-podium"></div>
          <div class="leaderboard-table">
            <table>
              <thead>
                <tr>
                  <th>RANK</th><th>PLAYER</th><th>LEVEL</th><th>TOTAL XP</th><th>ACHIEVEMENTS</th><th>ACTION</th>
                </tr>
              </thead>
              <tbody id="global-tbody"></tbody>
            </table>
          </div>
        </div>
      `;

      // Build a section per game (if any)
      Object.keys(window.GAMES || {}).forEach(gameId => {
        const game = window.GAMES[gameId];
        const sec = document.createElement('div');
        sec.className = 'leaderboard-section';
        sec.id = `${gameId}-section`;
        sec.innerHTML = `
          <div class="leaderboard-header">
            <h2 class="leaderboard-title">${game.icon || ''} ${String(game.name || '').toUpperCase()} HIGH SCORES</h2>
            <p class="leaderboard-subtitle">${game.subtitle || ''}</p>
          </div>
          <div class="podium" id="${gameId}-podium"></div>
          <div class="leaderboard-table">
            <table>
              <thead>
                <tr>
                  <th>RANK</th><th>PLAYER</th><th>HIGH SCORE</th><th>DATE</th><th>ACTION</th>
                </tr>
              </thead>
              <tbody id="${gameId}-tbody"></tbody>
            </table>
          </div>
        `;
        leaderboardsContainer.appendChild(sec);
      });
    }

    // loadGlobalLeaderboard uses your getAllPlayers() and prepares derived fields used in populateTable
    function loadGlobalLeaderboard() {
      const players = (typeof getAllPlayers === 'function') ? getAllPlayers() : [];
      const sortedPlayers = (players || []).map(p => ({
        ...p,
        xp: p.xp || 0,
        level: p.level || 1,
        achievementsCount: (p.achievements || []).filter(a => a.unlocked).length
      })).sort((a,b) => b.xp - a.xp);

      createPodium(sortedPlayers, 'global-podium', 'xp');
      populateTable(sortedPlayers, 'global-tbody', 'global');
    }

    // loadGameLeaderboard: for individual game highscore tables
    function loadGameLeaderboard(gameId) {
      const players = (typeof getAllPlayers === 'function') ? getAllPlayers() : [];
      const gamePlayers = [];
      players.forEach(player => {
        if (player.highScores && player.highScores[gameId]) {
          gamePlayers.push({
            username: player.username,
            avatar: player.avatar,
            score: player.highScores[gameId].score || 0,
            date: player.highScores[gameId].date || 'N/A',
            isBot: player.isBot || false
          });
        }
      });
      const sortedPlayers = gamePlayers.sort((a,b) => b.score - a.score);
      createPodium(sortedPlayers, gameId + '-podium', 'score');
      populateTable(sortedPlayers, gameId + '-tbody', 'game');
    }

    // Optional: loadDiscordScores (keeps original behavior with localhost API)
    async function loadDiscordScores(gameId) {
      try {
        const response = await fetch(`http://localhost:3000/api/leaderboard/${gameId}`);
        const data = await response.json();
        if (data && data.success) return data.leaderboard;
      } catch (err) {
        console.log('Discord scores unavailable:', err && err.message ? err.message : err);
      }
      return [];
    }

    // initializeLeaderboards: build + load
    function initializeLeaderboards() {
      buildLeaderboards();
      loadGlobalLeaderboard();
      Object.keys(window.GAMES || {}).forEach(gameId => {
        loadGameLeaderboard(gameId);
      });
    }

    // Run on DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        initializeLeaderboards();
        // refresh every 30s
        setInterval(() => {
          loadGlobalLeaderboard();
          Object.keys(window.GAMES || {}).forEach(gameId => loadGameLeaderboard(gameId));
        }, 30000);
      });
    } else {
      initializeLeaderboards();
      setInterval(() => {
        loadGlobalLeaderboard();
        Object.keys(window.GAMES || {}).forEach(gameId => loadGameLeaderboard(gameId));
      }, 30000);
    }

    // Expose hooks so your other scripts can call these easily
    window.initializeLeaderboards = initializeLeaderboards;
    window.loadGlobalLeaderboard = loadGlobalLeaderboard;
    window.loadGameLeaderboard = loadGameLeaderboard;
    window.loadDiscordScores = loadDiscordScores;

  })();
  </script>
</body>
</html>
